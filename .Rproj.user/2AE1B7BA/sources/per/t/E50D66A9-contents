# 웹프로그래밍을 응용한 데이터 스토리텔링 (심화)

앞 장의 말미에 ggplot을 이용해 조금 더 전문적인 스토리텔링을 위해 시각화를 개선할 수 있다는 이야기를 했습니다. 여러분이 직접 최종적인 시각화 결과물을 생산해야 하는 것이 아니라면 스토리텔링의 아이디어를 담당자에게 잘 전달하는 것으로 충분하겠지만, 직접 그래프를 만들어 내야 하는 상황이라면 우리가 앞 장 말미에 만들어낸 시각화 결과물로는 부족할 것입니다.

추가적인 시각화의 개선을 위한 기법에는 다양한 방식이 있을 수 있습니다. 여기서부터는 조금 더 고급 프로그래밍에 해당하기 때문에 상당 부분이 취향의 영역입니다. 여기서는 웹프로그래밍에서 사용하는 HTML, CSS 등의 요소를 이용해 시각화를 개선하는 방식을 취하겠습니다. 이는 이러한 방식이 다른 대안적인 방식에 비해 조금 더 직관적이기도 하고, 또 이미 웹프로그래밍에서 표준에 해당하는 기술을 응용하는 것이기 때문에 데이터 사이언스에 대한 지식과 상호 보완적인 면이 있기 때문이기도 합니다.

만약 여러분이 최종적인 시각화 결과물을 생산할 필요가 없다면, 이 장은 생략하셔도 좋습니다.

먼저 다음 패키지들을 설치해 주세요.

```{r, eval=FALSE}
install.packages(c("ggtext", "glue"))
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggtext)
library(glue)
Sys.setlocale("LC_ALL","Korean")
```

## 코로나 백신 접종 의사 데이터 받기

이 챕터에서 시각화에 활용할 데이터는 2020년 코로나가 기승을 부리던 당시, 세계 15개국에서 시행된 백신 접종 의사에 대한 설문조사 결과 입니다. 여기서 이야기할 내용은 미국 미시건 대학의 미생물학/면역학 교수인 [Patrick Schloss의 강의](https://www.youtube.com/watch?v=rkQREY_FfqI)를 일부 수정·전제한 것임을 밝힙니다. 관심이 있으신 분은 강의에 관한 Schloss 교수의 [블로그 포스트](https://riffomonas.org/code_club/2021-10-18-highlight)와 [깃허브 저장소](https://github.com/riffomonas/vaccination_attitudes) 역시 참조해 보시면 더 많은 정보를 얻을 수 있습니다.

먼저, 분석에 사용할 데이터를 불러오겠습니다.

```{r, message=FALSE, warning=FALSE}
data <- read_csv("data/august_october_2020.csv")
data
```

데이터에서 쉽게 확인할 수 있듯이, 해당 데이터는 각 행이 한 국가를 의미하며, 두번째 열은 8월 조사 결과, 세번째 열은 10월 조사 결과에 대한 정보를 담고 있습니다. 설문조사이니, 원 데이터는 설문 답변자 개개인의 답변 형태였겠지요. 여기서는 시각화 기법에만 집중하기 위해서 각 국가별 평균을 계산하는 전처리가 완료되었다고 가정하도록 하겠습니다.

먼저, 편의상 데이터에서 다소 난삽한 변수명을 미리 수정해 두겠습니다. `X.1`과 같이 직관적인 의미가 없는 변수명, `Total Agree - August 2020`와 같이 대문자 소문자, 띄어쓰기 등이 섞여있는 변수명은 이후 코딩을 하는데 있어 혼란의 여지가 될 가능성이 큽니다.

```{r}
data <- data |>
    rename(country = X.1, august = `Total Agree - August 2020`,
           october = `Total Agree - October 2020`)
data
```

`Total Agree - August 2020`과 같은 변수명의 경우 띄어쓰기로 인해 R이 'Total', 'Agree' 등을 모두 별도의 변수명으로 인식하게 되므로, backtick 기호를 통해 묶어줌으로써 `Total Agree - August 2020`가 하나의 변수명임을 명확하게 했다는 데 주목해 주세요.

## 중요 정보에 집중하기 - 한국의 변화 vs 다른 국가의 변화

앞 장에서 데이터 스토리텔링의 주요 원칙으로 전달하고자 하는 이야기를 더 중요한 정보와 덜 중요한 정보, 즉 '정보의 위계'로 전환할 필요성에 대해 이야기 했습니다. 그러면 백신 접종 의사 데이터로 전달하고자 하는 스토리를 가정해 보도록 하죠. 여기서 가정하는 스토리는 '한국의 접종 의사 변화가 다른 국가에 비해 높고, 8월과 10월 사이에 눈에 띄게 감소하지 않았다' 입니다. 돌이켜보면, 처음 접종을 시작한 아스트라제네카 백신이 영국에서 긴급승인된 것이 2020년 12월말이니, 8월과 10월 사이는 백신의 안전성에 대한 갑론을박이 격심했던 시기입니다. 때문에 많은 나라에서는 백신 접종 의사가 하락하는 모습을 보여왔죠. 이를 다음과 같은 변화 그래프로 표현하고 싶다고 해 보죠.

```{r}
data |>
    pivot_longer(!country, names_to="month", values_to="agree") |>
    ggplot() +
    aes(x=month, y=agree) +
    geom_point() +
    geom_line(aes(group=country))
```
물론, 이와 같은 그래프를 독자에게 보여줄 수는 없습니다. 무엇보다 어떤 선이 어떤 국가의 결과를 의미하는지도 알 수 없고, 더더군다나 한국이 어디에 해당하는지도 알 수 없죠. 그런데, 15개(사실 Total까지 포함해서 16개)의 국가를 그래프에 모두 표현해주면 어떻게 될까요? 독자들이 알아볼 수 없게 난삽한 그래프가 될 것입니다. 따라서, 여기서는 과감하게 기사의 스토리상 더 중요한 정보인 한국만을 다른 색으로 표현하고 덜 중요한 나머지 국가를 회색으로 표현하는 방식으로 정보의 위계를 표현해 보겠습니다. 

```{r}
data %>%
    pivot_longer(!country, names_to="month", values_to="agree") |>
    filter(country != "Total") |>
    mutate(highlight = ifelse(country=="South Korea", TRUE, FALSE)) |>
    ggplot(aes(x=month, y=agree, color=highlight)) +
    geom_point(show.legend=FALSE) +
    geom_line(aes(group=country, size=highlight), show.legend = FALSE) + 
    coord_fixed(ratio=0.04) +
    labs(x="",
         y="백신 투약 의사 비율",
         title="<span style='color: blue'>한국</span>의 백신 투약 의사는<br>오히려 상승") +
    scale_color_manual(breaks=c(TRUE, FALSE),
                         values=c("blue", "grey")) +
    scale_size_manual(breaks=c(TRUE, FALSE),
                      values=c(1, 0.5)) +
    scale_x_discrete(expand=c(0,0.1), 
                     breaks=c("august", "october"),labels=c("8월", "10월")) +
    theme(text = element_text(color="grey"),
          panel.background = element_rect(fill="white"),
          axis.title.y = element_text(size=15),
          axis.text = element_text(color="grey"),
          plot.title = element_markdown(),
          plot.title.position="plot")
```



## 프로페셔널한 그래프 그리기

## 아파트 실거래가 데이터 받기

## 간단한 시각화

## 지도 시각화
